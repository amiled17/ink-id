Bootstrap: library
From: ubuntu:18.04

%post
  apt-get update
  DEBIAN_FRONTEND=noninteractive apt-get install -y python3-dev python3-pip wget git-all
  pip3 install -U virtualenv
  virtualenv -p python3 tensorflow
  . /tensorflow/bin/activate
  pip install --upgrade pip
  pip install --upgrade tensorflow
  pip install --upgrade Cython
  git clone https://<username>:<password>@code.cs.uky.edu/seales-research/ink-id.git
  pip install -e ./ink-id/.

%runscript
  if [ $# -lt 1 ]; then
      echo "Usage: ./container RUN COMMAND"
      exit 1
  fi
  
  . /tensorflow/bin/activate
  exec "$@"  

%test
  . /tensorflow/bin/activate
  inkid-train-and-predict -h

%labels
  Maintainer Mami Hayashida <mami.hayashida@uky.edu>
  Version v.0.1

%help
  This is a Singularity container for testing Ink-id software using the CPU version
  of tensorflow. Inside the container, there is a virtuaenv environment with all the 
  necessary dependencies as well as the ink-id package pre-installed from the time of the 
  container-build.

  Run scripts as shown below: 
  	singularity run inkid-cpu.sif inkid-train-and-predict <args>
  	singularity run python <python_script>.py <args>
 
  To use singularity shell, remember to activate the virtualenv environment first
        . /tensorflow/bin/activate
   
